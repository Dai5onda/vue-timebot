(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-06c4"],{"/YRO":function(t,e,a){"use strict";var i=a("8iot");a.n(i).a},"6bP5":function(t,e,a){"use strict";var i=a("Qq1u");a.n(i).a},"8iot":function(t,e,a){},G2KY:function(t,e,a){"use strict";a.d(e,"a",function(){return d}),a.d(e,"f",function(){return u}),a.d(e,"b",function(){return f}),a.d(e,"d",function(){return p}),a.d(e,"e",function(){return h}),a.d(e,"c",function(){return m});var i=a("4d7F"),n=a.n(i),r=(a("aHnO"),a("P2sY")),s=a.n(r),o=a("QbLZ"),l=a.n(o),c=a("L2JU"),d={data:function(){return{pickerOptions:{disabledDate:function(t){return t.getTime()>Date.now()},shortcuts:[{text:"Last week",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-6048e5),t.$emit("pick",[a,e])}},{text:"Last month",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-2592e6),t.$emit("pick",[a,e])}},{text:"Last 3 months",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-7776e6),t.$emit("pick",[a,e])}}]},isAnswered:!0}},methods:{formatDate:function(t){if(t){var e=t.getDate();e<10&&(e="0"+e);var a=t.getMonth()+1;a<10&&(a="0"+a);var i=t.getFullYear();return i<10&&(i="0"+i),i+"-"+a+"-"+e}}},computed:l()({},Object(c.b)(["rangeDate"]),{date:{get:function(){return this.rangeDate},set:function(t){this.$store.dispatch("setRangeDate",t)}}}),created:function(){},mounted:function(){if(this.date){var t=new Date("2018-08-18"),e=new Date("2018-08-12");e.setTime(e.getTime()-6048e5),this.$store.dispatch("setRangeDate",[this.formatDate(e),this.formatDate(t)])}}},u={data:function(){var t=function(t,e,a){e?a():a(new Error)},e=function(t,e,a){e?a():a(new Error)};return{rules:{type:[{required:!0,message:"type is required",trigger:"change"}],date:[{validator:e,type:"date",required:!0,message:"Date is required",trigger:"blur"}],time:[{validator:e,type:"datetime",required:!0,message:"Time is required",trigger:"blur"}],title:[{required:!0,message:"title is required",trigger:"blur"}],id:[{validator:t,required:!0,message:"User is required",trigger:"change"}],project:[{validator:function(t,e,a){e?a():a(new Error)},required:!0,message:"Project is required",trigger:"change"}],name:[{validator:t,required:!0,message:"Name of project is requires",trigger:"change"}],team:[{required:!0,message:"Team is requires",trigger:"change"}]}}}},f={data:function(){return{dialogStatus:"",dialogFormVisible:!1,dialogViewVisible:!1,dialogFormLoading:!1,textMap:{update:"Edit",create:"Create",view:"View"},temp:{id:void 0,type:"",date:"",attributes:{"is-active":!1},relationships:{team:{data:{}},user:{data:{}},project:{data:{}}}}}},methods:{handleUpdate:function(t){var e=this;this.temp=s()({},t),this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick(function(){e.$refs.dataForm.clearValidate()})},handleCreate:function(){var t=this;this.resetTemp(),this.dialogStatus="create",this.dialogFormVisible=!0,this.$nextTick(function(){t.$refs.dataForm.clearValidate()})},handleView:function(t){this.temp=s()({},t),this.dialogStatus="view",this.dialogViewVisible=!0},resetTemp:function(){this.temp={id:void 0,type:"",date:"",attributes:{"is-active":!1},relationships:{team:{data:{}},user:{data:{}},project:{data:{}}}}}}},p={data:function(){return{}},methods:{handleSizeChange:function(t){var e=this;this.$store.dispatch("actionEntityTable/setPagination",{type:"limit",value:t}).then(function(){e.getList()})},handleCurrentChange:function(t){var e=this;this.$store.dispatch("actionEntityTable/setPagination",{type:"page",value:t}).then(function(){e.getList()})}}},h={beforeDestroy:function(){this.$store.dispatch("actionEntityTable/clearStore")},methods:{getList:function(){var t=this;return new n.a(function(e,a){t.$store.dispatch("actionEntityTable/setLoader",!0),t.$store.dispatch("actionEntityTable/fetchList",t.type).then(function(){t.$store.dispatch("actionEntityTable/setLoader",!1),e()})})},removeEntity:function(t,e){var a=this;this.$confirm("This will permanently delete the entity. Continue?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(function(){a.$store.dispatch("actionEntityTable/deleteEntity",{row:t,type:a.type}).then(function(){a.$message({message:"Project was deleted",type:"success"}),t.status=e})}).catch(function(){a.$message({type:"info",message:"Delete canceled"})})},createEntity:function(t){var e=this;return new n.a(function(a,i){e.$refs.dataForm.validate(function(i){i&&(e.dialogFormLoading=!0,e.$store.dispatch("actionEntityTable/createEntity",{row:t,type:e.type}).then(function(t){e.dialogFormVisible=!1,e.dialogFormLoading=!1,e.$notify({title:"Success",message:e.setMessageName(e.type)+" was created",type:"success",duration:2e3}),a()}).catch(function(){e.dialogFormVisible=!1,e.dialogFormLoading=!1}))})})},updateEntity:function(t){var e=this;this.$refs.dataForm.validate(function(a){a&&(e.dialogFormLoading=!0,e.$store.dispatch("actionEntityTable/updateEntity",{row:t,type:e.type}).then(function(){e.dialogFormVisible=!1,e.dialogFormLoading=!1,e.$notify({title:"Success",message:e.setMessageName(e.type)+" was updated",type:"success",duration:2e3})}).catch(function(t){console.log(t),e.dialogFormVisible=!1,e.dialogFormLoading=!1}))})},setMessageName:function(t){switch(t){case"projects":return"Project";case"time-entries":return"Time entry";case"users":return"User";case"teams":return"Team";case"holidays":return"Holiday";case"absences":return"Absence";case"admins":return"Admin"}},remoteGetProjects:function(t){var e=this;"string"!=typeof t&&(t=this.temp&&this.getIncluded(this.temp.relationships.project.data.id)||""),this.loading=!0,this.$store.dispatch("actionEntityTable/fetchEntityByName",{type:"projects",query:t}).then(function(){e.loading=!1})},remoteGetUsers:function(t){var e=this;"string"!=typeof t&&(t=this.temp&&this.getIncluded(this.temp.relationships.user.data.id)||""),this.loading=!0,this.$store.dispatch("actionEntityTable/fetchEntityByName",{type:"users",query:t}).then(function(){e.loading=!1})},filter:function(){var t=this;return new n.a(function(e,a){t.$store.dispatch("actionEntityTable/setLoader",!0),t.$store.dispatch("actionEntityTable/setFilter",t.entity).then(function(){t.$store.dispatch("actionEntityTable/fetchList",t.type).finally(function(){t.$store.dispatch("actionEntityTable/setLoader",!1),e()})})})}}},m={methods:{getIncluded:function(t){if(this.included(this.type)){var e=this.included(this.type).find(function(e){if(e.id===t)return e});if(e)return e.attributes.name}}}}},"MWG/":function(t,e,a){},Qq1u:function(t,e,a){},aHnO:function(t,e,a){t.exports={default:a("tbFO"),__esModule:!0}},"gDS+":function(t,e,a){t.exports={default:a("oh+g"),__esModule:!0}},iBI5:function(t,e,a){"use strict";a.r(e);var i=a("m1cH"),n=a.n(i),r=a("gDS+"),s=a.n(r),o=a("QbLZ"),l=a.n(o),c=a("G2KY"),d=a("L2JU"),u=a("rfXi"),f=a.n(u),p=a("Kw5r");function h(t,e,a,i,n){var r=[],s=[];return f()(t).forEach(function(t){void 0===t._expanded&&p.default.set(t,"_expanded",e);var o=1;if(void 0!==i&&null!==i&&(o=i+1),p.default.set(t,"_level",o),a?(p.default.set(t,"parent",a),r[o]||(r[o]=0),p.default.set(t,"_marginLeft",r[o]+a._marginLeft),p.default.set(t,"_width",t[n]/a[n]*a._width),r[o]+=t._width):(r[t.id]=[],r[t.id][o]=0,p.default.set(t,"_marginLeft",0),p.default.set(t,"_width",1)),s.push(t),t.time_entries&&t.time_entries.length>0){var l=h(t.time_entries,e,t,o,n);s=s.concat(l)}}),s}var m={name:"TimeReports",components:{treeTable:a("itRl").a},mixins:[c.e,c.c,c.a],data:function(){return{type:"timeReports",func:h,args:[null,null,"timeLine"],searchParams:{projects:""},columns:[{text:"Project",value:"name"}],groupedData:[],treeData:[],json_fields:{Collaborators:"collaborators",Date:"date",Details:"details",Time:"time","Trello labels":"trello-labels","Estimated time":"estimated-time","Total time":"total_time"},jsonData:[]}},computed:l()({},Object(d.b)({list:"actionEntityTable/list",loader:"actionEntityTable/loader",filterable:"actionEntityTable/filterable",included:"actionEntityTable/included"})),mounted:function(){this.getTimeReports()},methods:{getIncluded:function(t){if(this.included("time-entries")){var e=this.included("time-entries").find(function(e){if(e.id===t)return e});if(e)return e.attributes.name}},getTimeReports:function(){var t=this;null===this.date&&(this.date=[new Date,new Date]),this.$store.dispatch("actionEntityTable/setFilter",{by_projects:[this.searchParams.projects],date_from:this.date[0],date_to:this.date[1]}).then(function(){t.$store.dispatch("actionEntityTable/setPagination",{limit:100}).then(function(){t.$store.dispatch("actionEntityTable/setLoader",!0),t.searchParams.projects?t.$store.dispatch("actionEntityTable/fetchList","time-entries").then(function(){t.createTreeData()}).finally(function(){t.$store.dispatch("actionEntityTable/setLoader",!1)}):t.$store.dispatch("actionEntityTable/setLoader",!1)})})},groupByAttributes:function(t,e){return t.reduce(function(t,a){return(t[a.attributes[e]]=t[a.attributes[e]]||[]).push(a),t},{})},groupTreeData:function(){var t,e=this;if((t=this.list("time-entries").slice()).length){var a=this.groupByAttributes(t,"details"),i=[],n=function(t){var n=null,r=null,s=[];a.hasOwnProperty(t)&&(a[t].forEach(function(t){var a=t.attributes.time.split(":");n+=60*a[0]+ +a[1],r=n%60<10?"0"+n%60:n%60,s.find(function(e){return e.id===t.relationships.user.data.id})||(t.relationships.user.data.name=e.getIncluded(t.relationships.user.data.id),s.push(t.relationships.user.data))}),i.push({id:a[t][0].id,type:a[t][0].type,date:a[t][0].attributes.date,details:a[t][0].attributes.details,"estimated-time":a[t][0].attributes["estimated-time"],time:(n/60|0)+":"+r,"trello-labels":a[t][0].attributes["trello-labels"],collaborators:s})),e.groupedData=i};for(var r in a)n(r)}else this.groupedData=[]},createTreeData:function(){var t=this;this.groupTreeData();var e=null,a=null;this.groupedData.forEach(function(t){var a=t.time.split(":");e+=60*a[0]+ +a[1]}),a=e%60<10?"0"+e%60:e%60;var i={name:this.filterable("projects").find(function(e){if(e.id===t.searchParams.projects)return e}).name,time_entries:this.groupedData,total_time:(e/60|0)+":"+a};this.treeData=JSON.parse(s()(i));var r=JSON.parse(s()([].concat(n()(this.groupedData))));r.forEach(function(t){var e="";t.collaborators.forEach(function(t){e+=t.name+" "}),t.collaborators=e}),this.jsonData=r}}},g=(a("/YRO"),a("KHd+")),v=Object(g.a)(m,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loader,expression:"loader"}]},[a("div",{staticClass:"timebot-header"},[t._v("Weekly")]),a("div",{staticClass:"time-entries-filters-container"},[a("div",{staticClass:"time-entries-filters"},[a("div",{staticClass:"filters-label"},[t._v("Projects name"),a("el-select",{attrs:{filterable:"",remote:"",placeholder:"Please enter a projects","remote-method":t.remoteGetProjects},on:{focus:t.remoteGetProjects,change:t.getTimeReports},model:{value:t.searchParams.projects,callback:function(e){t.$set(t.searchParams,"projects",e)},expression:"searchParams.projects"}},t._l(t.filterable("projects"),function(t){return a("el-option",{key:t.id,attrs:{value:t.id,label:t.name}})}))],1)]),a("div",{staticClass:"time-entries-filters"},[a("div",{staticClass:"filters-label"},[t._v("Date"),a("el-date-picker",{attrs:{type:"daterange","range-separator":"-","value-format":"yyyy-MM-dd","start-placeholder":"Start date","picker-options":t.pickerOptions,"end-placeholder":"End date","prefix-icon":"date-calendar"},on:{change:t.getTimeReports},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1)]),a("div",{staticClass:"time-entries-filters"},[a("div",{staticClass:"filters-label-csv"},[a("download-excel",{directives:[{name:"show",rawName:"v-show",value:t.groupedData.length,expression:"groupedData.length"}],attrs:{data:t.jsonData,fields:t.json_fields,type:"csv",name:"time-reports.xls"}},[a("el-button",[t._v("Download CSV")])],1)],1)])]),a("tree-table",{attrs:{data:t.treeData,columns:t.columns,"eval-func":t.func,"eval-args":t.args,border:""}},[a("el-table-column",{attrs:{label:"Date"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.date))])]}}])}),a("el-table-column",{attrs:{label:"Collaborators"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"collaborators-container"},t._l(e.row.collaborators,function(e,i){return a("span",{key:e.id},[t._v(t._s(e.name)+" ")])}))]}}])}),a("el-table-column",{attrs:{label:"Details"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.details))])]}}])}),a("el-table-column",{attrs:{label:"Trello labels"},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(e.row["trello-labels"],function(e){return a("span",[t._v(t._s(e)+" ")])})}}])}),a("el-table-column",{attrs:{label:"Time"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.time))])]}}])}),a("el-table-column",{attrs:{label:"Total time"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.total_time))])]}}])})],1)],1)},[],!1,null,"388d5d16",null);v.options.__file="index.vue";e.default=v.exports},itRl:function(t,e,a){"use strict";var i=a("jr1U"),n=a.n(i),r=a("rfXi"),s=a.n(r),o=a("Kw5r");function l(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=[];return s()(t).forEach(function(t){void 0===t._expanded&&o.default.set(t,"_expanded",e);var r=1;if(void 0!==i&&null!==i&&(r=i+1),o.default.set(t,"_level",r),a&&o.default.set(t,"parent",a),n.push(t),t.children&&t.children.length>0){var s=l(t.children,e,t,r);n=n.concat(s)}}),n}var c={name:"TreeTable",props:{data:{type:[Array,Object],required:!0},columns:{type:Array,default:function(){return[]}},evalFunc:Function,evalArgs:Array,expandAll:{type:Boolean,default:!1}},computed:{formatData:function(){var t=void 0;t=Array.isArray(this.data)?this.data:[this.data];var e=this.evalFunc||l,a=this.evalArgs?n()([t,this.expandAll],this.evalArgs):[t,this.expandAll];return e.apply(null,a)}},methods:{showRow:function(t){var e=!t.row.parent||t.row.parent._expanded&&t.row.parent._show;return t.row._show=e,e?"animation:treeTableShow 1s;-webkit-animation:treeTableShow 1s;":"display:none;"},toggleExpanded:function(t){var e=t;e._expanded=!e._expanded},iconShow:function(t,e){return 0===t&&e.children&&e.children.length>0||0===t&&e.time_entries&&e.time_entries.length>0}}},d=(a("6bP5"),a("kLE5"),a("KHd+")),u=Object(d.a)(c,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-table",t._b({attrs:{data:t.formatData,"row-style":t.showRow},on:{"row-click":t.toggleExpanded}},"el-table",t.$attrs,!1),[t._l(t.columns,function(e,i){return a("el-table-column",{key:e.value,attrs:{label:e.text,width:e.width},scopedSlots:t._u([{key:"default",fn:function(n){return[t._l(n.row._level,function(e){return 0===i?a("span",{key:e,staticClass:"ms-tree-space"}):t._e()}),t._v("\n      "+t._s(n.row[e.value])+"\n      "),t.iconShow(i,n.row)?a("span",{staticClass:"tree-ctrl",on:{click:function(e){t.toggleExpanded(n.$index)}}},[n.row._expanded?a("i",{staticClass:"el-icon-arrow-up"}):a("i",{staticClass:"el-icon-arrow-down"})]):t._e()]}}])})}),t._v(" "),t._t("default")],2)},[],!1,null,"310c1a60",null);u.options.__file="index.vue";e.a=u.exports},jr1U:function(t,e,a){t.exports={default:a("wObO"),__esModule:!0}},kLE5:function(t,e,a){"use strict";var i=a("MWG/");a.n(i).a},"oh+g":function(t,e,a){var i=a("WEpk"),n=i.JSON||(i.JSON={stringify:JSON.stringify});t.exports=function(t){return n.stringify.apply(n,arguments)}},pGU1:function(t,e,a){var i=a("Y7ZC"),n=a("vwuL").f,r=a("5K7Z");i(i.S,"Reflect",{deleteProperty:function(t,e){var a=n(r(t),e);return!(a&&!a.configurable)&&delete t[e]}})},tbFO:function(t,e,a){a("pGU1"),t.exports=a("WEpk").Reflect.deleteProperty},wObO:function(t,e){t.exports=function(){return Function.call.apply(Array.prototype.concat,arguments)}}}]);